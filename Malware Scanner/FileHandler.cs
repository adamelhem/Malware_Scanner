using System.Text;

namespace Malware_Scanner
{
    public class FileHandler : IFileHandler
    {
        public void DeleteFile(string fullPath)
        {
            File.Delete(fullPath);
        }

        public string ReadFile(string path)
        {
            var data = new StringBuilder();

            var startTime = DateTime.Now;

            try
            {
                // Open the stream and read it back.
                using (FileStream fs = File.Open(path, FileMode.Open))
                {
                    byte[] b = new byte[1024];
                    UTF8Encoding temp = new UTF8Encoding(true);

                    while (fs.Read(b, 0, b.Length) > 0)
                    {
                        data.Append(temp.GetString(b));
                    }
                    Console.WriteLine(data);
                    return data.ToString();
                }
            }catch
            {
                if(DateTime.Now.Minute-startTime.Minute<3)
                {
                    System.Threading.Thread.Sleep(3000);
                    ReadFile(path);
                }
            }
            return data.ToString();
        }

        public void WriteFile(string path, string data)
        {
            using (FileStream fs = File.Open(path, FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite))
            {
                Byte[] info = new UTF8Encoding(true).GetBytes(data);
                // Add some information to the file.
                fs.Write(info, 0, info.Length);
            }
        }

    }
}